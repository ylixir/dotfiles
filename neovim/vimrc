"relative line numbers
set number relativenumber
"toggle to absolute line numbers unless we are in normal focus
augroup numbertoggle
  autocmd!
  autocmd BufEnter,FocusGained,InsertLeave * set relativenumber
  autocmd BufLeave,FocusLost,InsertEnter   * set norelativenumber
augroup END

"hack from reddit to keep terminal windows in the buffer list
augroup custom_term
    autocmd!
    autocmd TermOpen * setlocal nonumber norelativenumber bufhidden=hide
augroup END

set t_AB=^[[48;5;%dm
set t_AF=^[[38;5;%dm
set t_Co=256
set termguicolors
set colorcolumn=80
set cursorline
let g:airline_powerline_fonts = 1
let g:airline#extensions#tabline#enabled = 1
let g:airline_theme='bubblegum'
colorscheme inkpot

"Rainbow parentheses (kien version, not junegunn)
let g:rainbow#pairs = [['(', ')'], ['[', ']'], ['{', '}']]
au VimEnter * RainbowParentheses

set mouse=a
let mapleader=" "
set tabstop=8 softtabstop=0 expandtab shiftwidth=4 smarttab
nnoremap <silent> <leader>q :lclose<bar>bn<bar>bd #<CR>

"set up language servers
nnoremap <silent> K :call LanguageClient#textDocument_hover()<CR>
nnoremap <silent> gd :call LanguageClient#textDocument_definition()<CR>
nnoremap <silent> gr :call LanguageClient#textDocument_references()<CR>
"intelephense is faster, better feature support
let g:LanguageClient_serverCommands = {
    \ 'php' : ['intelephense', '--stdio'],
    \ }
"psalm is better at finding errors but we can only rock one lang server now
"https://github.com/autozimu/LanguageClient-neovim/issues/473
"    \ 'php' : ['php', './vendor/bin/psalm-language-server'],

"deoplete (autocompletion)
let g:deoplete#enable_at_startup = 1

"vista (display symbol tree)
let g:vista_default_executive = 'lcn'

"set up fzf (fuzzy finder)
nmap <Leader>F :Files<CR>
nmap <Leader>a :Ag<Space>
nmap <Leader>b :Buffers<CR>
nmap <Leader>f :GFiles<CR>

"slime
let g:slime_target = "neovim"

" Vdebug
let g:vdebug_keymap = {
\    "run" : "<Leader>/",
\    "run_to_cursor" : "<Up>",
\    "step_over" : "<Down>",
\    "step_into" : "<Right>",
\    "step_out" : "<Left>",
\    "close" : "q",
\    "detach" : "x",
\    "set_breakpoint" : "<Leader>p",
\    "eval_visual" : "<Leader>e"
\}

"nerdtree autoload (this seems annoying)
"autocmd vimenter * NERDTree

autocmd BufRead,BufNewFile *.elm set filetype=elm
autocmd FileType elm :packadd elm-vim

autocmd BufRead,BufNewFile *.jsonnet set filetype=jsonnet
autocmd FileType jsonnet :packadd vim-jsonnet

